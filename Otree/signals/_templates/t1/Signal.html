{% extends "global/Page.html" %}
{% load otree static %}

{% block title %}Treatment 1 â€” Signal{% endblock %}

{% block content %}
<p>Get ready to view the dot matrix. A 10-second countdown will start. The image will be shown for 6 seconds and then hidden automatically.</p>

<div class="mb-3">
  <div id="countdown" style="font-size: 1.2rem;">Countdown: {{ countdown_seconds }}</div>
</div>

<div id="image_wrap" style="display:none; margin: 1rem 0;">
  <img src="{% static image_file %}" alt="Signal image" class="img-fluid" />
  <div><em>The image will hide automatically.</em></div>
</div>

<button class="btn btn-primary" id="nextbtn" disabled>
  Continue
</button>


<script>
  // Disable the built-in Next so we can control enable timing
  const realNext = document.querySelector('button.next-button') || document.querySelector('button.otree-btn-next');
  if (realNext) { realNext.style.display = 'none'; }

  const proxyBtn = document.getElementById('nextbtn');
  proxyBtn.addEventListener('click', () => { if (realNext) realNext.click(); });

  let countdown = {{ countdown_seconds }};
  let showTime = {{ show_seconds }};
  const countdownEl = document.getElementById('countdown');
  const imgWrap = document.getElementById('image_wrap');

  const tick = setInterval(() => {
    countdown -= 1;
    countdownEl.textContent = 'Countdown: ' + countdown;
    if (countdown <= 0) {
      clearInterval(tick);
      countdownEl.style.display = 'none';
      // Show image for 6s
      imgWrap.style.display = 'block';
      setTimeout(() => {
        imgWrap.style.display = 'none';
        proxyBtn.disabled = false; // enable continue
      }, showTime * 1000);
    }
  }, 1000);
</script>
{% endblock %}
