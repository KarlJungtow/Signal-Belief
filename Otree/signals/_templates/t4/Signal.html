{% extends "global/Page.html" %}
{% load otree static %}

{% block title %}Treatment 4 — Signal{% endblock %}

{% block content %}

<div class="d-flex flex-column align-items-center gap-3">
  <button type="button" class="btn btn-primary btn-lg" id="show-btn">Show me</button>

  <div id="image_wrap" style="display:none; margin: 1rem 0; text-align: center;">
    <img src="{% static image_file %}" alt="Signal image" class="img-fluid" />
    <div id="timer" class="mt-2 lead"></div>
  </div>
</div>

{# Hidden real next button — triggered automatically #}
<div class="d-none">
  {% next_button %}
</div>

{% endblock %}

{% block scripts %}
<script>
  (function () {
    const showBtn = document.getElementById('show-btn');
    const imgWrap = document.getElementById('image_wrap');
    const timerEl = document.getElementById('timer');

    showBtn.addEventListener('click', function () {
      showBtn.disabled = true;
      imgWrap.style.display = 'block';

      let remaining = {{ show_seconds }};
      timerEl.textContent = `Time left: ${remaining}`;

      const intervalId = setInterval(() => {
        remaining -= 1;
        if (remaining > 0) {
          timerEl.textContent = `Time left: ${remaining}`;
        } else {
          clearInterval(intervalId);
          // auto-advance
          const form = document.getElementById('form');
          if (form) {
            form.submit();
          } else {
            const nextBtn = document.getElementById('otree-next-button');
            if (nextBtn) nextBtn.click();
          }
        }
      }, 1000);
    });
  })();
</script>
{% endblock %}
